# sai3-bench config for resnet50 workload - 8 hosts
# Matches rdf-bench parameters: width=64, depth=2, files=150 per directory per host
# Total: 4,096 leaf directories, 4,915,200 files (614,400 × 8), ~1050 GB

target: "gs://signal65-ai-ac"
duration: "5m"       # 300s run (matches rdf-bench rd_run elapsed=300)
concurrency: 64      # Matches rdf-bench threads=64 per host

prepare:
  prepare_strategy: parallel
  skip_verification: false
  
  # Create nested directory tree matching rdf-bench FSD:
  # width=64, depth=2, files=150 per host (150 × 8 hosts = 1,200 total)
  # rdf-bench: 8 hosts × 614,400 files/host = 4,915,200 files
  directory_structure:
    width: 64                 # 64 subdirectories per level (matches rdf-bench)
    depth: 2                  # 2 levels deep (matches rdf-bench)
    files_per_dir: 150        # 150 files/host × 8 hosts = 1,200 files per directory
    distribution: "bottom"    # Files only in leaf directories
    dir_mask: "scan.d%d_w%d.dir"
  
  # Total files calculation: 4,096 leaf dirs × 1,200 files/dir = 4,915,200 files
  ensure_objects:
    - base_uri: "gs://signal65-ai-ac"
      count: 614400     # 4,096 dirs × 1,200 files =614,400 files / host * 8 =  4,915,200 files (~1,050 GB)
      fill: random
      size_spec:
        type: lognormal
        mean: 229376       # ~224 KB (matches rdf-bench weighted avg)
        std_dev: 160563    # ~157 KB (70% for tight distribution)
        min: 32768         # 32 KB minimum
        max: 1048576       # 1 MB maximum
      dedup_factor: 1
      compress_factor: 1
  
  cleanup: false  # Keep data between runs

workload:
  # Sequential reads matching rdf-bench:
  # operation=read, fileio=sequential, xfersize=256k
  
  - op: get
    path: "scan.d*_w*.dir/**/*"  # Match actual directory structure
    weight: 100

# Distributed Configuration (8 agents)
distributed:
  shared_filesystem: true  # GCS is shared across all agents
  tree_creation_mode: coordinator  # Controller creates directory tree once
  path_selection: random  # Random file selection (maximum contention)
  agents:
    - address: "10.138.0.42:7761"
      id: "agent-1"
        #    - address: "10.138.0.29:7761"
        #id: "agent-2"
        #- address: "10.138.0.30:7761"
        #id: "agent-3"
        #- address: "10.138.0.31:7761"
        #id: "agent-4"
        #- address: "10.138.0.32:7761"
        #id: "agent-5"
        #- address: "10.138.0.33:7761"
        #id: "agent-6"
        #- address: "10.138.0.37:7761"
        #id: "agent-7"
        #- address: "10.138.0.39:7761"
        #id: "agent-8"
